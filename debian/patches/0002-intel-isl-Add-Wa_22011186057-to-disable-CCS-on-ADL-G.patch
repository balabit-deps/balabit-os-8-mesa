From 3c0fe912ab9bf5febd89df62e1767bc2c23937d9 Mon Sep 17 00:00:00 2001
From: Jordan Justen <jordan.l.justen@intel.com>
Date: Thu, 10 Dec 2020 01:42:12 -0800
Subject: [PATCH 2/3] intel/isl: Add Wa_22011186057 to disable CCS on ADL GT2
 A0

Cc: mesa-stable
Signed-off-by: Jordan Justen <jordan.l.justen@intel.com>
Reviewed-by: Nanley Chery <nanley.g.chery@intel.com>
Reviewed-by: Anuj Phogat <anuj.phogat@gmail.com>
Part-of: <https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/9465>
(cherry picked from commit 89f33126252e16dac61d4045f38a6eee76db944f)
---
 src/intel/isl/isl.c        | 5 +++++
 src/intel/isl/isl_format.c | 4 ++++
 2 files changed, 9 insertions(+)

diff --git a/src/intel/isl/isl.c b/src/intel/isl/isl.c
index e5d324a537c..e295b02c02a 100644
--- a/src/intel/isl/isl.c
+++ b/src/intel/isl/isl.c
@@ -1967,6 +1967,11 @@ isl_surf_supports_ccs(const struct isl_device *dev,
    if (ISL_DEV_GEN(dev) <= 6)
       return false;
 
+   /* Wa_22011186057: Disable compression on ADL-P A0 */
+   if (dev->info->is_alderlake && dev->info->gt == 2 &&
+       dev->info->revision == 0)
+      return false;
+
    if (surf->usage & ISL_SURF_USAGE_DISABLE_AUX_BIT)
       return false;
 
diff --git a/src/intel/isl/isl_format.c b/src/intel/isl/isl_format.c
index 6b848c2c53c..e7c56744184 100644
--- a/src/intel/isl/isl_format.c
+++ b/src/intel/isl/isl_format.c
@@ -856,6 +856,10 @@ bool
 isl_format_supports_ccs_e(const struct gen_device_info *devinfo,
                           enum isl_format format)
 {
+   /* Wa_22011186057: Disable compression on ADL-P A0 */
+   if (devinfo->is_alderlake && devinfo->gt == 2 && devinfo->revision == 0)
+      return false;
+
    if (!format_info_exists(format))
       return false;
 
-- 
2.32.0

